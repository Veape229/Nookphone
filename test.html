<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>NookPhone OS - NookLink (Êú¨Âú∞ÁâàÊú¨)</title>
    
    <meta name="theme-color" content="#7FE2C3">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">

    <link href="https://fonts.googleapis.com/css2?family=Varela+Round&family=Kosugi+Maru&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- ÁßªÈô§‰∫ÜÊâÄÊúâ LeanCloud SDK ÂºïÂÖ•ÂíåÂàùÂßãÂåñ‰ª£Á†Å -->

    <style>
        :root {
            --theme-bg: #7FE2C3;
            --theme-pattern: url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 40L40 0H20L0 20M40 40V20L20 40' fill='%23ffffff' fill-opacity='0.25' fill-rule='evenodd'/%3E%3C/svg%3E");
            --theme-primary: #3DAA86; 
            --theme-secondary: #FDFDF6;
            --theme-text: #59584D;
            --theme-btn-shadow: #2D8666;
            --safe-top: env(safe-area-inset-top, 20px);
            --safe-bottom: env(safe-area-inset-bottom, 20px);
        }

        body {
            font-family: 'Varela Round', 'Kosugi Maru', sans-serif;
            background-color: var(--theme-bg);
            background-image: var(--theme-pattern);
            background-size: 40px 40px; 
            color: var(--theme-text);
            height: 100dvh;
            width: 100vw;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
            transition: background-color 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Responsive Container */
        #root {
            height: 100%;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Nook UI Elements */
        .nook-card {
            background-color: #FDFDF6;
            border-radius: 28px;
            box-shadow: 0 6px 0 rgba(0,0,0,0.05), 0 12px 20px rgba(0,0,0,0.05); 
            padding: 16px;
            position: relative;
            transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        .nook-btn {
            background-color: var(--theme-primary);
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 999px;
            font-weight: 800;
            box-shadow: 0 5px 0 var(--theme-btn-shadow);
            transition: all 0.15s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            top: 0;
            transform: scale(1);
        }
        .nook-btn:active { top: 5px; box-shadow: 0 0 0 var(--theme-btn-shadow); transform: scale(0.95); }
        .nook-btn:disabled { opacity: 0.6; cursor: not-allowed; filter: grayscale(100%); transform: none; top:0; box-shadow: none;}

        .nook-btn-secondary {
            background-color: #E0E0E0;
            color: #7A7A7A;
            box-shadow: 0 5px 0 #BDBDBD;
        }
        .nook-btn-secondary:active { top: 5px; box-shadow: none; transform: scale(0.95); }

        .nook-input {
            width: 100%;
            background: #F0F0F0;
            border: 3px solid transparent;
            padding: 12px 16px;
            border-radius: 20px;
            font-weight: bold;
            color: #59584D;
            outline: none;
            transition: all 0.2s ease;
        }
        .nook-input:focus {
            background: #FFFFFF;
            border-color: var(--theme-primary);
            box-shadow: 0 0 0 4px rgba(61, 170, 134, 0.15);
            transform: scale(1.02);
        }

        /* App Icon Animations */
        .app-icon-container {
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .app-icon-container:hover { transform: scale(1.1) rotate(3deg); }
        .app-icon-container:active { transform: scale(0.9) rotate(-3deg); filter: brightness(0.9); }

        .app-icon {
            width: 64px; height: 64px;
            border-radius: 24px;
            background: linear-gradient(145deg, #ffffff 0%, #f0f0f0 100%);
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 6px 10px rgba(0,0,0,0.08), inset 0 2px 4px rgba(255,255,255,0.8);
            position: relative;
            overflow: hidden;
        }
        .app-icon::after {
            content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(to bottom right, rgba(255,255,255,0.8), rgba(255,255,255,0));
            opacity: 0.6; pointer-events: none;
        }

        /* Screen Transitions (Zoom & Pop) */
        .screen-enter { animation: screen-zoom-in 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }
        .screen-exit { animation: screen-zoom-out 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards; }

        @keyframes screen-zoom-in {
            0% { opacity: 0; transform: scale(0.8); }
            100% { opacity: 1; transform: scale(1); }
        }
        @keyframes screen-zoom-out {
            0% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(1.1); }
        }
        
        /* General Pop Animation */
        .animate-pop { animation: pop-in 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }
        @keyframes pop-in { 
            0% { transform: scale(0.8) translateY(10px); opacity: 0; } 
            100% { transform: scale(1) translateY(0); opacity: 1; } 
        }

        /* Loading Spinner */
        .nook-spinner { animation: spin-bounce 2s infinite ease-in-out; }
        @keyframes spin-bounce {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.2); }
            100% { transform: rotate(360deg) scale(1); }
        }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .progress-bar-fill { transition: width 0.8s cubic-bezier(0.34, 1.56, 0.64, 1); }
        
        /* Toggle Switch */
        .nook-switch { position: relative; display: inline-block; width: 52px; height: 32px; }
        .nook-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #e2e8f0; transition: .3s cubic-bezier(0.34, 1.56, 0.64, 1); border-radius: 34px; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1); }
        .slider:before { position: absolute; content: ""; height: 24px; width: 24px; left: 4px; bottom: 4px; background-color: white; transition: .3s cubic-bezier(0.34, 1.56, 0.64, 1); border-radius: 50%; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        input:checked + .slider { background-color: #3DAA86; }
        input:checked + .slider:before { transform: translateX(20px); }

        /* Glassmorphism for Containers */
        .glass-panel {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef, useCallback } = React;

        // ==========================================
        // 1. Core Utilities & Resources (MUST BE DEFINED FIRST)
        // ==========================================

        // Mock User ID for local persistence
        const MOCK_USER_ID = "local_user_001";
        
        // Helper to generate unique IDs (needed to replace LeanCloud objectId)
        const generateId = () => Math.random().toString(36).substring(2, 9);
        
        const AVATAR_LIBRARY = [
            "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2359584D' stroke-width='2'%3E%3Cpath d='M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2'/%3E%3Ccircle cx='12' cy='7' r='4'/%3E%3C/svg%3E",
            "https://veape229-1308125337.cos.ap-chengdu.myqcloud.com/Nook/pic1/%E7%8B%B8%E7%8C%AB.jpg",
            "https://veape229-1308125337.cos.ap-chengdu.myqcloud.com/Nook/pic1/%E8%B1%86%E7%B2%92.jpg",
            "https://veape229-1308125337.cos.ap-chengdu.myqcloud.com/Nook/pic1/%E8%A5%BF%E6%96%BD%E6%83%A0.jpg",
            "https://veape229-1308125337.cos.ap-chengdu.myqcloud.com/Nook/pic1/KK.jpg",
            "https://veape229-1308125337.cos.ap-chengdu.myqcloud.com/Nook/pic1/%E4%BC%81%E9%B9%85%E8%BE%BE.jpg",
            "https://veape229-1308125337.cos.ap-chengdu.myqcloud.com/Nook/pic1/%E5%A4%A7%E5%90%89.jpg",
            "https://veape229-1308125337.cos.ap-chengdu.myqcloud.com/Nook/pic1/%E5%B0%8F%E6%B6%A6.jpg",
            "https://veape229-1308125337.cos.ap-chengdu.myqcloud.com/Nook/pic1/%E7%8B%971.jpg",
            "https://veape229-1308125337.cos.ap-chengdu.myqcloud.com/Nook/pic1/%E9%B9%BF1.jpg",
            "https://veape229-1308125337.cos.ap-chengdu.myqcloud.com/Nook/pic1/%E8%B5%B5%E5%A5%87.jpg",
            "https://veape229-1308125337.cos.ap-chengdu.myqcloud.com/Nook/pic1/%E7%8C%AB1.jpg",
            "https://veape229-1308125337.cos.ap-chengdu.myqcloud.com/Nook/pic1/%E7%8C%AB2.jpg",
            "https://veape229-1308125337.cos.ap-chengdu.myqcloud.com/Nook/pic1/%E6%9C%88%E5%85%94.jpg",
            "https://veape229-1308125337.cos.ap-chengdu.myqcloud.com/Nook/pic1/%E5%A8%83%E5%A8%831.jpg",
            "https://veape229-1308125337.cos.ap-chengdu.myqcloud.com/Nook/pic1/%E5%A8%83%E5%A8%832.jpg",
            "https://veape229-1308125337.cos.ap-chengdu.myqcloud.com/Nook/pic1/%E7%9C%BC%E9%95%9C%E7%BB%BF.jpg",
            "https://veape229-1308125337.cos.ap-chengdu.myqcloud.com/Nook/pic1/%E7%BB%BF.jpg",
            "https://veape229-1308125337.cos.ap-chengdu.myqcloud.com/Nook/pic1/%E5%A8%83%E5%A8%833.jpg"
        ];
        
        const DIFFICULTIES = {
            simple: { label: 'ÁÆÄÂçï', xp: 2, color: 'bg-green-400', ring: 'ring-green-200' },
            normal: { label: 'ÊôÆÈÄö', xp: 5, color: 'bg-blue-400', ring: 'ring-blue-200' },
            hard: { label: 'Âõ∞Èöæ', xp: 10, color: 'bg-orange-400', ring: 'ring-orange-200' },
            hell: { label: 'Âú∞Áã±', xp: 20, color: 'bg-purple-500', ring: 'ring-purple-200' }
        };

        const THEMES = [
            { id: 'nook', name: 'Nook ÁªèÂÖ∏', bg: '#7FE2C3', primary: '#3DAA86', text: '#59584D', shadow: '#2D8666' },
            { id: 'sakura', name: 'Ê®±Ëä±Â≠£', bg: '#FFC6D0', primary: '#FF7D9A', text: '#7A4A53', shadow: '#D65D7A' },
            { id: 'summer', name: 'Â§èÊó•Ë¥ùÂ£≥', bg: '#6AC4F6', primary: '#3490DC', text: '#2C5282', shadow: '#2173B0' },
            { id: 'dodo', name: 'DAL Ëà™Á©∫', bg: '#2C5282', primary: '#ECC94B', text: '#ffffff', shadow: '#D69E2E' },
            { id: 'star', name: 'ÊµÅÊòüÈõ®', bg: '#4834d4', primary: '#f9ca24', text: '#ffffff', shadow: '#b38f00' },
            { id: 'mush', name: 'ËòëËèáÂ≠£', bg: '#eccc68', primary: '#ff6348', text: '#2f3542', shadow: '#e55039' },
            { id: 'brewster', name: 'È∏ΩÂ∑¢ÂíñÂï°', bg: '#1e272e', primary: '#27ae60', text: '#d2dae2', shadow: '#1e8045' },
            { id: 'snow', name: 'ÂÜ∞Èõ™Â≠£', bg: '#c7ecee', primary: '#130f40', text: '#130f40', shadow: '#485460' }
        ];

        const Icon = ({ path, size=24, color="currentColor", className="" }) => (
            <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round">
                {path}
            </svg>
        );

        const Icons = {
            Leaf: <><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z"/><path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12"/></>,
            User: <><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></>,
            CreditCard: <><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></>,
            Settings: <><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></>,
            Cloud: <><path d="M17.5 19c0-1.7-1.3-3-3-3h-1.1c-.2-3.1-2.9-5.5-6-5.5a6 6 0 0 0-5.6 8H17.5Z"/><path d="M12 2v8"/><path d="m9 7 3-3 3 3"/></>,
            LogOut: <><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></>,
            Lock: <><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></>,
            Book: <><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></>,
            Plus: <><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></>,
            Trash: <><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></>,
            Edit: <><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></>,
            Check: <><path d="M20 6 9 17l-5-5"/></>,
            Coin: <><circle cx="12" cy="12" r="10"/><path d="M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8"/><path d="M12 18V6"/></>,
            ArrowLeft: <><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></>,
            Activity: <><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></>,
            Scale: <><rect width="20" height="20" x="2" y="2" rx="5" ry="5"/><path d="M12 6a6 6 0 0 0 0 12 6 6 0 0 0 0-12zm0 2a4 4 0 0 1 0 8 4 4 0 0 1 0-8z"/><path d="M12 10l2 2"/></>,
            Utensils: <><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/></>,
            Refresh: <><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 16h5v5"/></>,
            Danger: <><polygon points="7.86 2 16.14 2 22 7.86 22 16.14 16.14 22 7.86 22 2 16.14 2 7.86 7.86 2"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></>,
            Mic: <><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></>,
            ChevronLeft: <><polyline points="15 18 9 12 15 6" /></>,
            ChevronRight: <><polyline points="9 18 15 12 9 6" /></>,
            Radio: <><circle cx="12" cy="12" r="2"/><path d="M16.24 7.76a6 6 0 0 1 0 8.49m-8.48-.01a6 6 0 0 1 0-8.49m11.31-2.82a10 10 0 0 1 0 14.14m-14.14 0a10 10 0 0 1 0-14.14"/></>,
            Mail: <><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></>
        };

        const getLevelInfo = (totalXP) => {
            let level = 1;
            let xp = totalXP;
            while (level < 100) {
                const required = level * 256;
                if (xp >= required) { xp -= required; level++; } else { break; }
            }
            return { level, currentXP: xp, requiredXP: level * 256, progress: (xp / (level * 256)) * 100 };
        };

        // ==========================================
        // 2. Data Factories (Requires Resources)
        // ==========================================

        const Factories = {
            User: (username) => ({
                id: MOCK_USER_ID,
                username: username,
                avatar: AVATAR_LIBRARY[0],
                themeId: 'nook',
            }),
            Stats: () => ({
                id: generateId(),
                level: 1,
                miles: 500,
                pocket: 3000,
                savings: 50000,
                xp: 0, 
                lastLoginDate: new Date().toLocaleDateString(),
            }),
            Task: (title, difficulty, type, reward, money, calories) => ({
                id: generateId(),
                title,
                difficulty,
                type,
                reward,
                completed: false,
                money: money || null, 
                calories: calories || null,
                date: new Date().toLocaleDateString(), 
                createdAt: Date.now(),
            }),
            Ledger: (type, amount, category, note) => ({
                id: generateId(),
                type, 
                amount: Number(amount),
                category,
                note,
                date: new Date().toLocaleDateString(),
                timestamp: Date.now()
            }),
            FitProfile: () => ({
                id: generateId(),
                height: null,
                weight: null,
                age: null,
                gender: 'male',
            }),
            FitLog: (date, type, val, note) => ({
                id: generateId(),
                date: date,
                type: type, 
                val: Number(val),
                note: note,
                time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
                timestamp: Date.now()
            }),
            VoiceWork: (title, price) => ({
                id: generateId(),
                title: title,
                price: Number(price),
                settled: false,
                createdAt: Date.now(),
                date: new Date().toLocaleDateString(),
            })
        };

        // ==========================================
        // 3. Local Storage Helpers & Initial Data
        // ==========================================
        
        const LOCAL_STORAGE_KEY = 'NookLink_LocalData';

        const getLocalData = () => {
            const data = localStorage.getItem(LOCAL_STORAGE_KEY);
            return data ? JSON.parse(data) : null;
        };

        const setLocalData = (data) => {
            localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(data));
        };

        const INITIAL_DATA = {
            userDoc: Factories.User('Resident'),
            stats: Factories.Stats(),
            fitProfile: Factories.FitProfile(),
            // Mock initial collection data
            tasks: [
                Factories.Task('ÂàùÊ¨°ÊäµËææ', 'simple', 'ÁîüÊ¥ª', 2, {type:'income', amount:500}, null),
                Factories.Task('ÂêëÁã∏ÂÖãÈóÆÂ•Ω', 'normal', 'Â∑•‰Ωú', 5, null, null)
            ],
            ledger: [],
            fitLogs: [],
            voiceWorks: []
        };

        // ==========================================
        // 4. Components
        // ==========================================

        // AuthScreen ÁÆÄÂåñ‰∏∫‰ªÖÊéßÂà∂Êú¨Âú∞ÁôªÂΩïÁä∂ÊÄÅ
        const AuthScreen = ({ onAuthSuccess }) => {
            const [username, setUsername] = useState("");
            const [password, setPassword] = useState("");
            const [isRegister, setIsRegister] = useState(false);
            const [loading, setLoading] = useState(false); 
            const [error, setError] = useState("");
            
            // Ê®°ÊãüÊú¨Âú∞ËÆ§ËØÅÂíåÊï∞ÊçÆÂàùÂßãÂåñ
            const handleSubmit = () => {
                if (!username || !password) return setError("Áî®Êà∑ÂêçÂíåÂØÜÁ†Å‰∏çËÉΩ‰∏∫Á©∫");
                
                setLoading(true);
                setError("");

                setTimeout(() => {
                    setLoading(false);
                    // Ê®°ÊãüÊàêÂäüÔºåÂπ∂‰ΩøÁî®ÂΩìÂâçÁî®Êà∑ÂêçÂàùÂßãÂåñÁî®Êà∑Êï∞ÊçÆ
                    const newUserData = Factories.User(username);
                    const initialData = { ...INITIAL_DATA, userDoc: newUserData };
                    
                    // Â∞ÜÊñ∞Êï∞ÊçÆÂ≠òÂÖ•Êú¨Âú∞Â≠òÂÇ®
                    setLocalData(initialData);

                    // Ëß¶Âèë App ÁªÑ‰ª∂Âä†ËΩΩÊï∞ÊçÆ
                    onAuthSuccess(newUserData); 
                }, 500);
            };

            const handleKeyDown = (e) => {
                if (e.key === 'Enter') handleSubmit();
            };

            const isSubmitting = loading;

            return (
                <div className="absolute inset-0 z-50 flex flex-col items-center justify-center p-6 bg-[#7FE2C3] bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTAgNDBMNDAgMEgyMEwwIDIwTTQwIDQwVjIwTjIwIDQwIiBmaWxsPSIjZmZmZmZmIiBmaWxsLW9wYWNpdHk9IjAuMiIgZmlsbC1ydWxlPSJldmVub2RkIi8+PC9zdmc+')] animate-pop">
                    <div className="mb-8 flex flex-col items-center">
                        <div className={`w-24 h-24 bg-white rounded-[30px] flex items-center justify-center shadow-lg mb-4 transform rotate-3 ${isSubmitting ? 'nook-spinner' : 'animate-bounce'}`}>
                            <Icon path={Icons.Leaf} size={60} color="#3DAA86"/>
                        </div>
                        <h1 className="text-3xl font-black text-[#59584D] tracking-wide">NookLink</h1>
                        <p className="text-[#3DAA86] font-bold text-sm bg-white/50 px-3 py-1 rounded-full mt-2 backdrop-blur-sm shadow-sm">{isRegister ? "Êñ∞Â±ÖÊ∞ëÁôªËÆ∞" : "Â≤õÂ±øÂÖ•Âè£"}</p>
                    </div>
                    <div className="nook-card w-full max-w-xs shadow-2xl border-[6px] border-white/40 backdrop-blur-sm bg-white/90">
                        {error && <div className="bg-red-100 text-red-500 text-xs font-bold p-3 rounded-xl mb-4 text-center border-l-4 border-red-500 animate-pop">{error}</div>}
                        
                        <div className="space-y-4 mb-4">
                            <div><label className="text-xs font-bold text-gray-500 ml-2 mb-1 block">Áî®Êà∑Âêç (Êú¨Âú∞Â≠òÂÇ®)</label><input className="nook-input" placeholder="ËæìÂÖ•‰ªªÊÑèÁî®Êà∑Âêç" type="text" value={username} onChange={e=>setUsername(e.target.value)} onKeyDown={handleKeyDown}/></div>
                            <div><label className="text-xs font-bold text-gray-500 ml-2 mb-1 block">ÂØÜÁ†Å (‰ªªÊÑè)</label><input className="nook-input" placeholder="ËæìÂÖ•‰ªªÊÑèÂØÜÁ†Å" type="password" value={password} onChange={e=>setPassword(e.target.value)} onKeyDown={handleKeyDown}/></div>
                        </div>
                        
                        <button onClick={handleSubmit} disabled={isSubmitting} className="nook-btn w-full mt-2 flex justify-center items-center gap-2">
                            {isSubmitting ? "ËΩΩÂÖ•‰∏≠..." : (isRegister ? "ËøõÂÖ•Â≤õÂ±ø (ÂàùÂßãÂåñÊï∞ÊçÆ)" : "ËøõÂÖ•Â≤õÂ±ø (Âä†ËΩΩÊú¨Âú∞Êï∞ÊçÆ)")}
                        </button>
                        
                        <button onClick={() => { setIsRegister(!isRegister); setError(''); }} disabled={isSubmitting} className="w-full text-xs font-bold text-gray-400 mt-4 py-2 hover:text-gray-600 transition">
                            {isRegister ? "Â∑≤ÊúâÊú¨Âú∞Êï∞ÊçÆ? ÂÅáË£ÖÁôªÂΩï" : "ÈúÄË¶ÅÂàùÂßãÂåñÊï∞ÊçÆ? ÂÅáË£ÖÊ≥®ÂÜå"}
                        </button>
                    </div>
                    <div className="mt-8 text-white/60 font-bold text-xs">NOOK INC. LOCAL DATA STORAGE</div>
                </div>
            );
        };
        
        // --- Components (mostly unchanged UI logic) ---

        const FitnessApp = ({ profile, logs, updateProfile, addLog, user }) => {
            const [view, setView] = useState('dashboard');
            const [pHeight, setPHeight] = useState(profile?.height || '');
            const [pWeight, setPWeight] = useState(profile?.weight || '');
            const [pAge, setPAge] = useState(profile?.age || '');
            const [pGender, setPGender] = useState(profile?.gender || 'male');
            
            const [logType, setLogType] = useState('exercise'); 
            const [logValue, setLogValue] = useState('');
            const [timeView, setTimeView] = useState('day'); 

            // Aggregate Data Logic
            const aggregatedData = useMemo(() => {
                const now = new Date();
                const numDays = timeView === 'week' ? 7 : (timeView === 'month' ? 30 : 1);
                let totalExercise = 0, totalIntake = 0;
                let weightSum = 0, weightCount = 0;
                let history = []; 

                // Use timestamp for date calculation
                const relevantLogs = logs.filter(l => {
                    const diffTime = Math.abs(now.getTime() - l.timestamp);
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
                    return diffDays <= numDays;
                });

                relevantLogs.forEach(l => {
                    if (l.type === 'exercise') totalExercise += Number(l.val);
                    if (l.type === 'intake') totalIntake += Number(l.val);
                    if (l.type === 'weight') { weightSum += Number(l.val); weightCount++; }
                });

                history = relevantLogs.sort((a,b) => b.timestamp - a.timestamp);
                const currentWeight = profile?.weight || 0;
                const displayWeight = weightCount > 0 && timeView !== 'day' ? (weightSum / weightCount).toFixed(1) : currentWeight;
                return { totalExercise, totalIntake, displayWeight, history };
            }, [logs, timeView, profile]);

            const bmr = useMemo(() => {
                if (!profile?.weight || !profile?.height || !profile?.age) return 0;
                let val = (10 * profile.weight) + (6.25 * profile.height) - (5 * profile.age);
                return profile.gender === 'male' ? val + 5 : val - 161;
            }, [profile]);
            
            const periodBmr = bmr * (timeView === 'week' ? 7 : (timeView === 'month' ? 30 : 1));
            const bmi = (profile?.weight && profile?.height) ? (profile.weight / Math.pow(profile.height/100, 2)).toFixed(1) : 0;

            const handleSaveProfile = () => {
                if(!pHeight || !pWeight || !pAge) return alert("ËØ∑ÂÆåÊï¥Â°´ÂÜô‰ø°ÊÅØ");
                updateProfile({ ...profile, height: parseFloat(pHeight), weight: parseFloat(pWeight), age: parseInt(pAge), gender: pGender });
                setView('dashboard');
            };

            const handleSaveLog = () => {
                if (!logValue) return alert("ËØ∑ËæìÂÖ•Êï∞ÂÄº");
                const val = parseFloat(logValue);
                if (logType === 'weight') updateProfile({ ...profile, weight: val });
                addLog(logType, val, logType === 'exercise' ? 'ÊâãÂä®ËÆ∞ÂΩï' : (logType==='weight'?'‰ΩìÈáçËÆ∞ÂΩï':'È•ÆÈ£üËÆ∞ÂΩï'));
                setLogValue(''); setView('dashboard');
            };

            if (view === 'setup' || !profile?.height) {
                return (
                    <div className="flex flex-col flex-1 min-h-0 screen-enter h-full relative">
                        {profile?.height && <div className="absolute top-0 left-0 z-10"><button onClick={()=>setView('dashboard')} className="p-2 hover:bg-gray-200 rounded-full text-gray-500 transition-colors"><Icon path={Icons.ArrowLeft} size={24}/></button></div>}
                        <div className="flex-1 overflow-y-auto no-scrollbar flex flex-col justify-center pb-8 p-1">
                            <div className="text-center mb-6">
                                <div className="w-20 h-20 bg-[#4299E1] rounded-full flex items-center justify-center text-white mx-auto mb-4 shadow-lg animate-pop"><Icon path={Icons.Activity} size={40}/></div>
                                <h2 className="text-xl font-black text-[#59584D]">NookFit</h2>
                                <p className="text-sm text-gray-500 font-bold mt-2">ÂÆåÂñÑÊÇ®ÁöÑË∫´‰ΩìÊ°£Ê°à</p>
                            </div>
                            <div className="nook-card space-y-4">
                                <div className="grid grid-cols-2 gap-4">
                                    <div><label className="text-xs font-bold text-gray-400 ml-2 block mb-1">Ë∫´È´ò (cm)</label><input type="number" value={pHeight} onChange={e=>setPHeight(e.target.value)} className="nook-input text-center" placeholder="0" /></div>
                                    <div><label className="text-xs font-bold text-gray-400 ml-2 block mb-1">‰ΩìÈáç (kg)</label><input type="number" value={pWeight} onChange={e=>setPWeight(e.target.value)} className="nook-input text-center" placeholder="0" /></div>
                                </div>
                                <div className="grid grid-cols-2 gap-4">
                                    <div><label className="text-xs font-bold text-gray-400 ml-2 block mb-1">Âπ¥ÈæÑ</label><input type="number" value={pAge} onChange={e=>setPAge(e.target.value)} className="nook-input text-center" placeholder="0" /></div>
                                    <div>
                                        <label className="text-xs font-bold text-gray-400 ml-2 block mb-1">ÊÄßÂà´</label>
                                        <div className="flex bg-gray-100 p-1 rounded-xl h-[50px] items-center">
                                            <button onClick={()=>setPGender('male')} className={`flex-1 h-full rounded-lg font-bold text-xs transition-all ${pGender==='male'?'bg-white text-blue-500 shadow-sm scale-95':'text-gray-400'}`}>Áî∑</button>
                                            <button onClick={()=>setPGender('female')} className={`flex-1 h-full rounded-lg font-bold text-xs transition-all ${pGender==='female'?'bg-white text-pink-500 shadow-sm scale-95':'text-gray-400'}`}>Â•≥</button>
                                        </div>
                                    </div>
                                </div>
                                <button onClick={handleSaveProfile} className="nook-btn w-full bg-[#4299E1] mt-2">‰øùÂ≠òÊ°£Ê°à</button>
                            </div>
                        </div>
                    </div>
                );
            }

            if (view === 'log') {
                return (
                    <div className="flex flex-col flex-1 min-h-0 screen-enter h-full">
                        <div className="flex items-center gap-2 mb-4 shrink-0">
                            <button onClick={()=>setView('dashboard')} className="p-2 -ml-2 hover:bg-gray-200 rounded-full text-gray-500 transition-colors"><Icon path={Icons.ArrowLeft} size={24}/></button>
                            <h2 className="text-xl font-black opacity-80">ËÆ∞ÂΩïÊï∞ÊçÆ</h2>
                        </div>
                        <div className="nook-card space-y-6 animate-pop">
                            <div className="flex bg-gray-100 p-1 rounded-xl">
                                {['exercise','intake','weight'].map(t => (
                                    <button key={t} onClick={()=>setLogType(t)} className={`flex-1 py-2 rounded-lg font-bold text-xs transition-all ${logType===t ? 'bg-white shadow-sm scale-95 ' + (t==='exercise'?'text-orange-500':(t==='intake'?'text-green-500':'text-blue-500')) : 'text-gray-400'}`}>
                                        {t==='exercise'?'ËøêÂä®':(t==='intake'?'È•ÆÈ£ü':'‰ΩìÈáç')}
                                    </button>
                                ))}
                            </div>
                            <div className="text-center">
                                <div className="text-xs font-bold text-gray-400 mb-2 uppercase">{logType==='weight' ? 'ÂΩìÂâç‰ΩìÈáç (kg)' : 'ÁÉ≠ÈáèÊï∞ÂÄº (kcal)'}</div>
                                <input type="number" autoFocus value={logValue} onChange={e=>setLogValue(e.target.value)} className="w-full text-center text-5xl font-black bg-transparent outline-none border-b-2 border-gray-200 focus:border-[#4299E1] pb-2 transition-all" placeholder="0"/>
                            </div>
                            <button onClick={handleSaveLog} className="nook-btn w-full bg-[#4299E1]">Á°ÆËÆ§ËÆ∞ÂΩï</button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="flex flex-col flex-1 min-h-0 screen-enter relative h-full">
                    <div className="flex items-center justify-between mb-4 shrink-0">
                        <div className="flex items-center gap-2">
                            <div className="w-10 h-10 bg-[#4299E1] rounded-full flex items-center justify-center text-white"><Icon path={Icons.Activity} /></div>
                            <h2 className="text-xl font-black opacity-80">NookFit</h2>
                        </div>
                        <button onClick={()=>{ setPHeight(profile.height); setPWeight(profile.weight); setPAge(profile.age); setPGender(profile.gender); setView('setup');}} className="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-gray-500 hover:bg-white transition-colors"><Icon path={Icons.Settings} size={16}/></button>
                    </div>

                    <div className="flex bg-white/50 p-1 rounded-xl mb-4 backdrop-blur-sm shrink-0">
                        {['day','week','month'].map(t => (
                            <button key={t} onClick={()=>setTimeView(t)} className={`flex-1 py-1.5 rounded-lg text-xs font-bold transition-all ${timeView===t?'bg-white text-[#4299E1] shadow-sm scale-95':'text-gray-500'}`}>{t==='day'?'‰ªäÊó•':(t==='week'?'Êú¨Âë®':'Êú¨Êúà')}</button>
                        ))}
                    </div>

                    <div className="bg-[#2D3748] rounded-[24px] p-5 text-white shadow-lg mb-4 flex justify-between items-center relative overflow-hidden shrink-0 transition-transform hover:scale-[1.02]">
                        <div className="absolute top-0 right-0 w-32 h-32 bg-white/5 rounded-full -mr-8 -mt-8"></div>
                        <div className="grid grid-cols-2 gap-4 relative z-10">
                            <div><div className="text-[10px] font-bold opacity-50 mb-1">{timeView==='day'?'WEIGHT':'AVG WEIGHT'}</div><div className="text-2xl font-black">{aggregatedData.displayWeight} <span className="text-sm font-bold opacity-50">kg</span></div></div>
                            <div><div className="text-[10px] font-bold opacity-50 mb-1">BMI</div><div className="text-2xl font-black text-[#63B3ED]">{bmi}</div></div>
                            <div className="col-span-2 pt-3 border-t border-white/10">
                                <div className="flex justify-between items-end mb-1"><div className="text-[10px] font-bold opacity-50">NET BURN</div><div className="text-2xl font-black text-[#F6AD55]">{(periodBmr + aggregatedData.totalExercise - aggregatedData.totalIntake).toFixed(0)} <span className="text-xs">kcal</span></div></div>
                                <div className="flex justify-between text-[10px] font-bold opacity-60"><span>Âü∫Á°Ä: {periodBmr.toFixed(0)}</span><span>ËøêÂä®: {aggregatedData.totalExercise}</span><span>ÊëÑÂÖ•: {aggregatedData.totalIntake}</span></div>
                            </div>
                        </div>
                    </div>

                    <button onClick={()=>setView('log')} className="absolute bottom-6 right-2 bg-[#4299E1] text-white px-4 py-3 rounded-full shadow-xl hover:bg-[#3182CE] transition active:scale-95 flex items-center gap-2 z-30 font-bold animate-pop">
                        <Icon path={Icons.Plus} size={18}/> ËÆ∞‰∏ÄÁ¨î
                    </button>

                    <div className="flex-1 overflow-y-auto no-scrollbar pb-24">
                        <div className="flex items-center gap-2 mb-2 px-2">
                            <div className="w-1 h-4 bg-gray-300 rounded-full"></div>
                            <h3 className="text-xs font-bold text-gray-400">ÂéÜÂè≤ËÆ∞ÂΩï</h3>
                        </div>
                        <div className="space-y-2">
                            {aggregatedData.history.length === 0 && <div className="text-center text-xs text-gray-300 py-10 font-bold opacity-50 flex flex-col items-center"><div className="text-2xl mb-2">üèÉ</div>ÊöÇÊó†ËøêÂä®Êï∞ÊçÆ</div>}
                            {aggregatedData.history.map((rec, i) => (
                                <div key={rec.id} className="bg-white rounded-xl p-3 flex justify-between items-center shadow-sm animate-pop" style={{animationDelay: `${i*50}ms`}}>
                                    <div className="flex items-center gap-3">
                                        <div className={`w-8 h-8 rounded-full flex items-center justify-center ${rec.type==='exercise'?'bg-orange-100 text-orange-500': (rec.type==='intake' ? 'bg-green-100 text-green-500' : 'bg-blue-100 text-blue-500')}`}>
                                            <Icon path={rec.type==='exercise'?Icons.Activity: (rec.type==='intake'?Icons.Utensils:Icons.Scale)} size={16}/>
                                        </div>
                                        <div>
                                            <div className="text-xs font-bold text-[#59584D]">{rec.note}</div>
                                            <div className="text-[10px] text-gray-400 font-bold">{rec.date} {rec.time}</div>
                                        </div>
                                    </div>
                                    <div className={`text-sm font-black ${rec.type==='exercise'?'text-orange-500':(rec.type==='intake'?'text-green-500':'text-blue-500')}`}>
                                        {rec.type==='weight' ? rec.val+'kg' : (rec.type==='exercise'?'-':'+')+rec.val}
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const FinanceApp = ({ stats, updateStats }) => {
            const [mode, setMode] = useState('transfer'); 
            const [amount, setAmount] = useState('');
            const [editPocket, setEditPocket] = useState(stats?.pocket || 0);
            const [editSavings, setEditSavings] = useState(stats?.savings || 0);
            
            useEffect(() => {
                if (stats) {
                    setEditPocket(stats.pocket || 0);
                    setEditSavings(stats.savings || 0);
                }
            }, [stats]);


            const handleTrans = (type) => {
                const val = parseInt(amount);
                if (!val || val <= 0) return alert("ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÈáëÈ¢ù");
                if (type === 'deposit') { 
                    if (stats.pocket < val) return alert("ÈìÉÈí±‰∏çË∂≥ÔºÅ"); 
                    updateStats({ pocket: stats.pocket - val, savings: stats.savings + val }); 
                } else { 
                    if (stats.savings < val) return alert("‰ΩôÈ¢ù‰∏çË∂≥ÔºÅ"); 
                    updateStats({ pocket: stats.pocket + val, savings: stats.savings - val }); 
                }
                setAmount('');
            };
            const handleSaveManagement = () => {
                const p = parseInt(editPocket); const s = parseInt(editSavings);
                if (isNaN(p) || isNaN(s) || p < 0 || s < 0) return; // Basic validation
                updateStats({ pocket: p, savings: s }); setMode('transfer');
            };

            return (
                <div className="flex flex-col flex-1 min-h-0 screen-enter text-[#59584D] h-full">
                     {/* üü¢ Modified Header: Added Settings Button here */}
                     <div className="flex items-center justify-between mb-4 shrink-0">
                        <div className="flex items-center gap-2">
                            <div className="w-10 h-10 bg-[#ECC94B] rounded-full flex items-center justify-center text-white"><Icon path={Icons.CreditCard} /></div>
                            <h2 className="text-xl font-black opacity-80">ABD</h2>
                        </div>
                        <button onClick={() => setMode(mode === 'transfer' ? 'manage' : 'transfer')} className={`w-8 h-8 rounded-full flex items-center justify-center transition-all ${mode==='manage' ? 'bg-[#3DAA86] text-white shadow-md' : 'bg-gray-200 text-gray-500 hover:bg-white'}`}>
                            <Icon path={Icons.Settings} size={16} /> 
                        </button>
                     </div>

                     <div className="bg-[#E2E8F0] p-5 rounded-[24px] shadow-inner border-8 border-[#CBD5E0] mb-4 shrink-0">
                        <div className="bg-[#2D3748] rounded-xl p-4 mb-4 text-[#48BB78] font-mono text-right shadow-inner border-4 border-[#1A202C]"><div className="text-xs opacity-50 mb-1 font-bold">ABD BALANCE</div><div className="text-3xl font-bold tracking-widest">{(stats?.savings || 0).toLocaleString()}</div></div>
                        <div className="flex justify-between items-end"><div className="text-center"><div className="text-[10px] font-bold text-gray-500 mb-1">POCKET</div><div className="text-xl font-black text-[#D69E2E]">{(stats?.pocket || 0).toLocaleString()}</div></div></div>
                     </div>
                     <div className="flex-1 overflow-y-auto no-scrollbar pb-6">
                        {mode === 'transfer' && (
                             <div className="nook-card flex flex-col justify-center gap-4 animate-pop min-h-full">
                                <div className="text-center font-bold mb-2 text-sm opacity-80">Nook Ëá™Âä®Â≠òÂèñÊ¨æÊú∫</div>
                                <div className="relative"><input type="number" placeholder="ËæìÂÖ•ÈáëÈ¢ù" value={amount} onChange={e=>setAmount(e.target.value)} className="w-full bg-[#F0F0F0] p-4 rounded-2xl text-center text-2xl font-black outline-none border-b-4 border-transparent focus:border-[#3DAA86] transition-colors placeholder-gray-300"/><div className="absolute right-4 top-1/2 -translate-y-1/2 text-xs font-bold text-gray-400">BELLS</div></div>
                                <div className="grid grid-cols-2 gap-4 mt-2"><button onClick={()=>handleTrans('deposit')} className="nook-btn bg-[#48BB78] text-white py-4 shadow-[0_6px_0_#2F855A] active:shadow-none active:top-1.5 transition-all">Â≠òÂÖ•</button><button onClick={()=>handleTrans('withdraw')} className="nook-btn bg-[#E53E3E] text-white py-4 shadow-[0_6px_0_#9B2C2C] active:shadow-none active:top-1.5 transition-all">ÂèñÂá∫</button></div>
                             </div>
                        )}
                        {mode === 'manage' && (
                             <div className="nook-card flex flex-col gap-4 animate-pop border-l-8 border-[#3DAA86] min-h-full">
                                <div className="text-center font-bold mb-2 text-sm opacity-80 flex items-center justify-center gap-2">Ë¥¶Êà∑ËµÑÈáë‰øÆÊ≠£</div>
                                <div><label className="text-xs font-bold text-gray-400 block mb-1 ml-2">POCKET</label><input type="number" value={editPocket} onChange={e=>setEditPocket(e.target.value)} className="w-full bg-[#FFFBEB] p-3 rounded-xl text-center text-xl font-bold outline-none text-[#D69E2E]"/></div>
                                <div><label className="text-xs font-bold text-gray-400 block mb-1 ml-2">ABD</label><input type="number" value={editSavings} onChange={e=>setEditSavings(e.target.value)} className="w-full bg-[#F0FFF4] p-3 rounded-xl text-center text-xl font-bold outline-none text-[#48BB78]"/></div>
                                <button onClick={handleSaveManagement} className="nook-btn mt-auto w-full">‰øùÂ≠ò‰øÆÊîπ</button>
                             </div>
                        )}
                     </div>
                </div>
            );
        };
        
        const LedgerApp = ({ ledger, addRecord, deleteRecord }) => {
            const [view, setView] = useState('list'); 
            const [type, setType] = useState('expense');
            const [amount, setAmount] = useState('');
            const [category, setCategory] = useState('ÂÖ∂‰ªñ');
            const [note, setNote] = useState('');
            const categories = type === 'expense' ? ['ÂêÉÈ•≠', 'Èõ∂È£ü', 'Â®±‰πê', 'ÁîüÊ¥ª', '‰∫§ÈÄö', 'ÊúçÈ•∞', 'Êó•Áî®ÂìÅ'] : ['Â∑•‰Ωú', 'Âà©ÊÅØ', 'ÂÖ∂‰ªñ'];
            
            const summary = useMemo(() => {
                let inc = 0, exp = 0;
                ledger.forEach(r => r.type === 'income' ? inc += Number(r.amount) : exp += Number(r.amount));
                return { income: inc, expense: exp, balance: inc - exp };
            }, [ledger]);

            const handleAdd = () => {
                if(!amount) return alert("ËØ∑ËæìÂÖ•ÈáëÈ¢ù");
                addRecord(type, Number(amount), category, note);
                setAmount(''); setNote(''); setView('list');
            };

            if (view === 'add') {
                return (
                    <div className="flex flex-col flex-1 min-h-0 screen-enter h-full">
                        <div className="flex items-center gap-2 mb-4 shrink-0"><button onClick={()=>setView('list')} className="p-2 -ml-2 hover:bg-gray-200 rounded-full transition-colors text-gray-500"><Icon path={Icons.ArrowLeft} size={24}/></button><h2 className="text-xl font-black opacity-80">ËÆ∞‰∏ÄÁ¨î</h2></div>
                        <div className="flex-1 overflow-y-auto no-scrollbar space-y-4 pb-4">
                            <div className="flex bg-gray-200 p-1 rounded-xl">
                                <button onClick={()=>setType('expense')} className={`flex-1 py-2 rounded-lg font-bold text-sm transition-all ${type==='expense'?'bg-white text-red-500 shadow-sm scale-95':'text-gray-500'}`}>ÊîØÂá∫</button>
                                <button onClick={()=>setType('income')} className={`flex-1 py-2 rounded-lg font-bold text-sm transition-all ${type==='income'?'bg-white text-green-500 shadow-sm scale-95':'text-gray-500'}`}>Êî∂ÂÖ•</button>
                            </div>
                            <div className="nook-card"><label className="text-xs font-bold text-gray-400 mb-1 block">ÈáëÈ¢ù</label><input type="number" value={amount} onChange={e=>setAmount(e.target.value)} className="w-full text-3xl font-black bg-transparent outline-none border-b-2 border-gray-100 py-2" placeholder="0"/></div>
                            <div>
                                <label className="text-xs font-bold text-gray-500 mb-2 block ml-2">ÈÄâÊã©ÂàÜÁ±ª</label>
                                <div className="grid grid-cols-4 gap-2">{categories.map(c => (<button key={c} onClick={()=>setCategory(c)} className={`py-2 rounded-xl text-xs font-bold border-2 transition-all ${category===c?'border-[#3DAA86] bg-white text-[#3DAA86] scale-95':'border-transparent bg-white/50 text-gray-500'}`}>{c}</button>))}</div>
                            </div>
                            <div className="nook-card p-3"><input value={note} onChange={e=>setNote(e.target.value)} className="w-full bg-transparent outline-none text-sm font-bold placeholder-gray-300" placeholder="Ê∑ªÂä†Â§áÊ≥® (ÈÄâÂ°´)"/></div>
                            <button onClick={handleAdd} className="nook-btn w-full flex justify-center mt-4">ÂÆåÊàê</button>
                        </div>
                    </div>
                );
            }
            return (
                <div className="flex flex-col flex-1 min-h-0 screen-enter relative h-full">
                    <div className="flex items-center justify-between mb-4 shrink-0">
                        <div className="flex items-center gap-2"><div className="w-10 h-10 bg-[#FFD166] rounded-full flex items-center justify-center text-white"><Icon path={Icons.Book} /></div><h2 className="text-xl font-black opacity-80">ËÆ∞Ë¥¶Êú¨</h2></div>
                    </div>

                    <div className="bg-[#3D405B] rounded-[24px] p-5 text-[#F4F1DE] shadow-lg mb-4 flex justify-between items-center relative overflow-hidden shrink-0 transition-transform hover:scale-[1.02]">
                        <div className="absolute right-0 bottom-0 w-24 h-24 bg-white/5 rounded-full -mr-6 -mb-6"></div>
                        <div><div className="text-[10px] opacity-60 font-bold mb-1">Êú¨ÊúàÁªì‰Ωô</div><div className="text-2xl font-black tracking-wide">{summary.balance.toLocaleString()}</div></div>
                        <div className="text-right space-y-1"><div><span className="text-[10px] bg-green-500/20 text-green-300 px-1.5 rounded mr-1">Êî∂</span><span className="text-sm font-bold">{summary.income.toLocaleString()}</span></div><div><span className="text-[10px] bg-red-500/20 text-red-300 px-1.5 rounded mr-1">ÊîØ</span><span className="text-sm font-bold">{summary.expense.toLocaleString()}</span></div></div>
                    </div>
                    
                    <button onClick={()=>setView('add')} className="absolute bottom-6 right-2 bg-[#3DAA86] text-white px-4 py-3 rounded-full shadow-xl hover:bg-[#2F855A] transition active:scale-95 flex items-center gap-2 z-30 font-bold animate-pop">
                        <Icon path={Icons.Plus} size={18}/> ËÆ∞‰∏ÄÁ¨î
                    </button>

                    <div className="flex-1 overflow-y-auto no-scrollbar space-y-3 pb-24">
                        {ledger.length === 0 && <div className="text-center text-gray-400 py-10 text-xs font-bold opacity-50 flex flex-col items-center"><div className="text-2xl mb-2">üìí</div>ÊöÇÊó†Ë¥¶ÂçïËÆ∞ÂΩï</div>}
                        {ledger.map((item, i) => (
                            <div key={item.id} className="bg-white rounded-2xl p-4 shadow-sm flex justify-between items-center group animate-pop" style={{animationDelay: `${i*50}ms`}}>
                                <div className="flex items-center gap-3">
                                    <div className={`w-10 h-10 rounded-full flex items-center justify-center text-white font-bold text-xs shadow-sm ${item.type==='expense'?'bg-red-400':'bg-green-400'}`}>{item.category.substring(0,2)}</div>
                                    <div><div className="font-bold text-[#59584D] text-sm">{item.category} <span className="text-xs font-normal text-gray-400 ml-1">{item.note}</span></div><div className="text-[10px] text-gray-400 font-bold">{item.date}</div></div>
                                </div>
                                <div className="flex items-center gap-3"><span className={`font-black ${item.type==='expense'?'text-red-500':'text-green-500'}`}>{item.type==='expense'?'-':'+'}{item.amount.toLocaleString()}</span><button onClick={()=>deleteRecord(item.id)} className="text-gray-300 hover:text-red-400 transition transform hover:scale-110"><Icon path={Icons.Trash} size={14}/></button></div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const VoiceWorkApp = ({ voiceWorks, addWork, toggleSettled, deleteWork }) => {
            const [view, setView] = useState('list');
            const [title, setTitle] = useState('');
            const [price, setPrice] = useState('');
            
            // Month Navigation State
            const [currentMonth, setCurrentMonth] = useState(new Date());

            const nextMonth = () => {
                const d = new Date(currentMonth);
                d.setMonth(d.getMonth() + 1);
                setCurrentMonth(d);
            };

            const prevMonth = () => {
                const d = new Date(currentMonth);
                d.setMonth(d.getMonth() - 1);
                setCurrentMonth(d);
            };

            // Filter Logic
            const monthlyData = useMemo(() => {
                const y = currentMonth.getFullYear();
                const m = currentMonth.getMonth();
                
                // Use stored createdAt (timestamp) for filtering
                const filtered = voiceWorks
                    .filter(w => {
                        const d = new Date(w.createdAt); 
                        return d.getFullYear() === y && d.getMonth() === m;
                    })
                    .sort((a,b) => b.createdAt - a.createdAt); // Sort by timestamp

                let settled = 0, pending = 0;
                filtered.forEach(w => w.settled ? settled += w.price : pending += w.price);
                
                return { list: filtered, settled, pending };
            }, [voiceWorks, currentMonth]);

            const handleSave = () => {
                if(!title || !price) return alert("ËØ∑Â°´ÂÜôÂÆåÊï¥‰ø°ÊÅØ");
                addWork(title, price);
                setTitle(''); setPrice(''); setView('list');
            };

            if(view === 'add') {
                return (
                    <div className="flex flex-col flex-1 min-h-0 screen-enter h-full">
                        <div className="flex items-center gap-2 mb-4 shrink-0"><button onClick={()=>setView('list')} className="p-2 -ml-2 hover:bg-gray-200 rounded-full transition-colors text-gray-500"><Icon path={Icons.ArrowLeft} size={24}/></button><h2 className="text-xl font-black opacity-80">Ê∑ªÂä†Â∑•‰Ωú</h2></div>
                        <div className="flex-1 overflow-y-auto no-scrollbar space-y-4 pb-4">
                            <div className="nook-card p-4">
                                <label className="text-xs font-bold text-gray-400 mb-1 block">ÂΩïÈü≥ÂêçÁß∞</label>
                                <input value={title} onChange={e=>setTitle(e.target.value)} className="w-full text-lg font-bold bg-transparent outline-none border-b-2 border-gray-100 py-2" placeholder="‰æãÂ¶ÇÔºöÁ¨¨1ÈõÜ..."/>
                            </div>
                            <div className="nook-card p-4">
                                <label className="text-xs font-bold text-gray-400 mb-1 block">Êä•ÈÖ¨Âçï‰ª∑</label>
                                <input type="number" value={price} onChange={e=>setPrice(e.target.value)} className="w-full text-lg font-bold bg-transparent outline-none border-b-2 border-gray-100 py-2" placeholder="0"/>
                            </div>
                            <button onClick={handleSave} className="nook-btn w-full mt-4">‰øùÂ≠òËÆ∞ÂΩï</button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="flex flex-col flex-1 min-h-0 screen-enter relative h-full">
                    <div className="flex items-center justify-between mb-4 shrink-0">
                        <div className="flex items-center gap-2">
                            <div className="w-10 h-10 bg-[#805AD5] rounded-full flex items-center justify-center text-white"><Icon path={Icons.Mic} /></div>
                            <h2 className="text-xl font-black opacity-80">ÂΩïÈü≥Âä©Êâã</h2>
                        </div>
                        
                        <div className="flex items-center bg-white/50 rounded-full px-1 py-1 backdrop-blur-sm">
                            <button onClick={prevMonth} className="p-1.5 hover:bg-white/80 rounded-full text-gray-600 transition-colors"><Icon path={Icons.ChevronLeft} size={16}/></button>
                            <span className="text-xs font-bold text-[#59584D] mx-2 min-w-[60px] text-center">
                                {currentMonth.getFullYear()}Âπ¥{currentMonth.getMonth() + 1}Êúà
                            </span>
                            <button onClick={nextMonth} className="p-1.5 hover:bg-white/80 rounded-full text-gray-600 transition-colors"><Icon path={Icons.ChevronRight} size={16}/></button>
                        </div>
                    </div>

                    <div className="bg-[#2D3748] rounded-[24px] p-5 text-white shadow-lg mb-4 flex justify-between items-center relative overflow-hidden shrink-0 transition-transform hover:scale-[1.02]">
                        <div className="absolute right-0 bottom-0 w-24 h-24 bg-white/5 rounded-full -mr-6 -mb-6"></div>
                        <div>
                            <div className="text-[10px] font-bold opacity-50 mb-1 uppercase">Pending ({currentMonth.getMonth()+1}Êúà)</div>
                            <div className="text-2xl font-black text-[#F6AD55] tracking-wide">{monthlyData.pending.toLocaleString()}</div>
                        </div>
                        <div className="text-right">
                            <div>
                                <div className="text-[10px] font-bold opacity-50 mb-1 uppercase">Settled ({currentMonth.getMonth()+1}Êúà)</div>
                                <div className="text-xl font-bold text-[#68D391]">{monthlyData.settled.toLocaleString()}</div>
                            </div>
                        </div>
                    </div>

                    <button onClick={()=>setView('add')} className="absolute bottom-6 right-2 bg-[#805AD5] text-white px-4 py-3 rounded-full shadow-xl hover:bg-[#6B46C1] transition active:scale-95 flex items-center gap-2 z-30 font-bold animate-pop">
                        <Icon path={Icons.Plus} size={18}/> ËÆ∞‰∏ÄÁ¨î
                    </button>

                    <div className="flex-1 overflow-y-auto no-scrollbar space-y-3 pb-24">
                        {monthlyData.list.length === 0 && <div className="text-center text-gray-400 py-10 text-xs font-bold opacity-50 flex flex-col items-center"><div className="text-2xl mb-2">üéôÔ∏è</div>Êú¨ÊúàÊöÇÊó†Â∑•‰ΩúËÆ∞ÂΩï</div>}
                        {monthlyData.list.map((item, i) => (
                            <div key={item.id} className={`bg-white rounded-2xl p-4 shadow-sm flex justify-between items-center group animate-pop ${item.settled ? 'opacity-60' : ''}`} style={{animationDelay: `${i*50}ms`}}>
                                <div className="flex items-center gap-3">
                                    <div className={`w-10 h-10 rounded-full flex items-center justify-center font-bold text-xs shadow-sm transition-colors ${item.settled ? 'bg-green-100 text-green-500' : 'bg-purple-100 text-purple-500'}`}>
                                        <Icon path={item.settled ? Icons.Check : Icons.Mic} size={18}/>
                                    </div>
                                    <div>
                                        <div className={`font-bold text-sm ${item.settled ? 'line-through text-gray-400' : 'text-[#59584D]'}`}>{item.title}</div>
                                        <div className="text-[10px] text-gray-400 font-bold">{new Date(item.createdAt).toLocaleDateString()}</div>
                                    </div>
                                </div>
                                <div className="flex items-center gap-3">
                                    <span className={`font-black ${item.settled ? 'text-gray-400' : 'text-[#805AD5]'}`}>+{item.price.toLocaleString()}</span>
                                    <button onClick={()=>toggleSettled(item.id)} className={`p-2 rounded-full border-2 transition-all ${item.settled ? 'bg-green-500 border-green-500 text-white' : 'border-gray-200 text-gray-300 hover:border-[#805AD5] hover:text-[#805AD5]'}`}>
                                        <Icon path={Icons.Check} size={14}/>
                                    </button>
                                    <button onClick={()=>deleteWork(item.id)} className="text-gray-300 hover:text-red-400 transition"><Icon path={Icons.Trash} size={14}/></button>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };
        
        const NookMilesApp = ({ stats, tasks, addTask, completeTask }) => {
            const [view, setView] = useState('list');
            const [newTitle, setNewTitle] = useState('');
            const [newDiff, setNewDiff] = useState('normal');
            const [newType, setNewType] = useState('ÁîüÊ¥ª');
            const [linkMoney, setLinkMoney] = useState(false);
            const [moneyType, setMoneyType] = useState('income');
            const [moneyAmount, setMoneyAmount] = useState('');
            const [fitnessValue, setFitnessValue] = useState('');
            const levelInfo = getLevelInfo(stats?.xp || 0);

            const handleAddTask = () => {
                if(!newTitle) return alert("ËØ∑ËæìÂÖ•‰ªªÂä°ÂÜÖÂÆπ");
                addTask(newTitle, newDiff, newType, DIFFICULTIES[newDiff].xp, 
                    linkMoney ? { type: moneyType, amount: parseInt(moneyAmount) } : null,
                    (newType === 'ÂÅ•Ë∫´' || newType === 'ÂêÉÈ•≠') ? parseInt(fitnessValue) : null
                );
                setNewTitle(''); setView('list'); setLinkMoney(false); setMoneyAmount(''); setFitnessValue('');
            };

            if (view === 'add') {
                return (
                    <div className="flex flex-col flex-1 min-h-0 screen-enter h-full">
                        <div className="flex items-center gap-2 mb-4 shrink-0">
                            <button onClick={()=>setView('list')} className="p-2 -ml-2 hover:bg-gray-200 rounded-full transition-colors text-gray-500"><Icon path={Icons.ArrowLeft} size={24}/></button>
                            <h2 className="text-xl font-black opacity-80">ÂèëÂ∏É‰ªªÂä°</h2>
                        </div>
                        <div className="flex-1 overflow-y-auto no-scrollbar space-y-4 pb-4">
                            <div className="nook-card p-4">
                                <label className="text-xs font-bold text-gray-400 mb-1 block">‰ªªÂä°ÂÜÖÂÆπ</label>
                                <input value={newTitle} onChange={e=>setNewTitle(e.target.value)} className="w-full text-lg font-bold bg-transparent outline-none border-b-2 border-gray-100 py-2" placeholder="‰æãÂ¶ÇÔºöÂéªÈíìÈ±º..."/>
                            </div>
                            <div>
                                <label className="text-xs font-bold text-gray-500 mb-2 block ml-2">ÈÄâÊã©Á±ªÂûã</label>
                                <div className="grid grid-cols-3 gap-2">{['Â∑•‰Ωú', 'Â®±‰πê', 'ÁîüÊ¥ª', 'ÂÅ•Ë∫´', 'ÂêÉÈ•≠'].map(t => (<button key={t} onClick={()=>setNewType(t)} className={`py-2 rounded-xl text-xs font-bold border-2 transition-all ${newType===t?'border-[#3DAA86] bg-white text-[#3DAA86] scale-95':'border-transparent bg-white/50 text-gray-500'}`}>{t}</button>))}</div>
                            </div>
                            
                            {(newType === 'ÂÅ•Ë∫´' || newType === 'ÂêÉÈ•≠') && (
                                <div className={`nook-card border-l-8 ${newType==='ÂÅ•Ë∫´'?'border-orange-400':'border-green-400'}`}>
                                    <label className="text-xs font-bold text-gray-500 mb-1 block">{newType === 'ÂÅ•Ë∫´' ? 'È¢ÑËÆ°Ê∂àËÄó (kcal)' : 'È¢ÑËÆ°ÊëÑÂÖ• (kcal)'}</label>
                                    <input type="number" value={fitnessValue} onChange={e=>setFitnessValue(e.target.value)} className="w-full bg-transparent border-b-2 border-gray-200 py-1 text-center font-black text-xl outline-none transition-colors" placeholder="0"/>
                                </div>
                            )}

                            <div>
                                <label className="text-xs font-bold text-gray-500 mb-2 block ml-2">ÈöæÂ∫¶ (XP)</label>
                                <div className="grid grid-cols-2 gap-3">
                                    {Object.entries(DIFFICULTIES).map(([key, cfg]) => (
                                        <button key={key} onClick={()=>setNewDiff(key)} className={`p-3 rounded-xl border-4 text-left transition-all relative overflow-hidden ${newDiff===key ? 'border-[#3DAA86] bg-white shadow-md scale-95' : 'border-transparent bg-white/50'}`}>
                                            <div className={`absolute top-0 right-0 p-1 px-2 text-[10px] text-white font-bold rounded-bl-lg ${cfg.color}`}>{cfg.xp} XP</div>
                                            <div className="font-bold text-[#59584D]">{cfg.label}</div>
                                        </button>
                                    ))}
                                </div>
                            </div>

                            <div className="nook-card border-l-8 border-yellow-400">
                                <div className="flex items-center justify-between mb-2">
                                    <label className="text-xs font-bold text-gray-500">ÈáëÈí±ÂèòÂä®</label>
                                    <label className="nook-switch scale-75"><input type="checkbox" checked={linkMoney} onChange={e=>setLinkMoney(e.target.checked)}/><span className="slider"></span></label>
                                </div>
                                {linkMoney && (
                                    <div className="space-y-3 animate-pop">
                                        <div className="flex bg-gray-100 p-1 rounded-lg">
                                            <button onClick={()=>setMoneyType('income')} className={`flex-1 py-1.5 rounded-md text-xs font-bold transition-all ${moneyType==='income'?'bg-white text-green-600 shadow-sm scale-95':'text-gray-400'}`}>Ëé∑Âæó</button>
                                            <button onClick={()=>setMoneyType('expense')} className={`flex-1 py-1.5 rounded-md text-xs font-bold transition-all ${moneyType==='expense'?'bg-white text-red-500 shadow-sm scale-95':'text-gray-400'}`}>Ê∂àËÄó</button>
                                        </div>
                                        <div className="relative"><input type="number" value={moneyAmount} onChange={e=>setMoneyAmount(e.target.value)} className="w-full bg-transparent border-b-2 border-gray-200 py-1 text-center font-black text-xl outline-none focus:border-yellow-400 transition-colors" placeholder="0"/><div className="absolute right-0 top-2 text-[10px] font-bold text-gray-400">BELLS</div></div>
                                    </div>
                                )}
                            </div>
                            <button onClick={handleAddTask} className="nook-btn w-full flex justify-center mt-4">ÂèëÂ∏É‰ªªÂä°</button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="flex flex-col flex-1 min-h-0 screen-enter h-full">
                    <div className="flex items-center justify-between mb-4 shrink-0">
                        <div className="flex items-center gap-3">
                            <div className="w-12 h-12 bg-[#3DAA86] rounded-full flex items-center justify-center text-white shadow-md relative">
                                <Icon path={Icons.Leaf} size={24}/>
                                <div className="absolute -bottom-1 -right-1 bg-yellow-400 text-yellow-900 text-[10px] font-black w-6 h-6 rounded-full flex items-center justify-center border-2 border-white animate-bounce" style={{animationDuration:'3s'}}>{levelInfo.level}</div>
                            </div>
                            <div>
                                <h2 className="text-lg font-black opacity-80">ÈõÜÈáåÊ∏∏+</h2>
                                <div className="w-24 h-2 bg-gray-200 rounded-full mt-1 overflow-hidden"><div className="h-full bg-yellow-400 progress-bar-fill" style={{width: `${levelInfo.progress}%`}}></div></div>
                                <div className="text-[10px] text-gray-400 font-bold mt-0.5">LV.{levelInfo.level} ({parseInt(levelInfo.currentXP)}/{levelInfo.requiredXP})</div>
                            </div>
                        </div>
                        <button onClick={()=>setView('add')} className="w-8 h-8 bg-[#3DAA86] rounded-full flex items-center justify-center text-white shadow-md active:scale-95 transition"><Icon path={Icons.Plus} size={18}/></button>
                    </div>

                    <div className="flex-1 overflow-y-auto no-scrollbar space-y-3 pb-6">
                        {tasks.length === 0 && <div className="text-center text-xs opacity-50 py-10 flex flex-col items-center"><div className="text-2xl mb-2">üå¥</div>‰ªäÂ§©Ê≤°Êúâ‰ªªÂä°‰∫ÜÔºå‰ºëÊÅØ‰∏Ä‰∏ãÂêß</div>}
                        {tasks.map((t, i) => {
                            const diff = DIFFICULTIES[t.difficulty || 'normal']; 
                            return (
                                <div key={t.id} className={`bg-white rounded-2xl p-4 border-l-8 shadow-sm flex justify-between items-center animate-pop ${t.completed ? 'border-gray-300 opacity-60' : 'border-[#F4A261]'}`} style={{animationDelay: `${i*50}ms`}}>
                                    <div className="flex items-center gap-3">
                                        <div className={`w-3 h-3 rounded-full ${diff.color} shadow-sm ring-2 ${diff.ring}`}></div>
                                        <div>
                                            <div className="font-bold text-[#59584D] flex items-center gap-2">
                                                {t.title}
                                                {t.type && <span className="text-[9px] bg-gray-200 text-gray-500 px-1.5 py-0.5 rounded-md font-bold">{t.type}</span>}
                                                {t.money && <span className={`text-[10px] px-1.5 py-0.5 rounded-full flex items-center gap-1 ${t.money.type==='income' ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-500'}`}><Icon path={Icons.Coin} size={10}/> {t.money.amount}</span>}
                                                {t.calories && <span className={`text-[10px] px-1.5 py-0.5 rounded-full flex items-center gap-1 ${t.type==='ÂÅ•Ë∫´' ? 'bg-orange-100 text-orange-600' : 'bg-green-100 text-green-600'}`}><Icon path={t.type==='ÂÅ•Ë∫´' ? Icons.Activity : Icons.Utensils} size={10}/> {t.calories}</span>}
                                            </div>
                                            <div className="text-[10px] font-black text-[#38B2AC] bg-[#E6FFFA] px-1.5 py-0.5 rounded inline-block mt-1">{diff.label} +{t.reward} XP</div>
                                        </div>
                                    </div>
                                    {t.completed ? <div className="text-[#3DAA86]"><Icon path={Icons.Leaf}/></div> : <button onClick={() => completeTask(t.id)} className="w-10 h-10 rounded-full border-4 border-[#E2E8F0] text-[#CBD5E0] flex items-center justify-center hover:bg-[#3DAA86] hover:text-white transition-all transform active:scale-90"><Icon path={Icons.Check} size={20}/></button>}
                                </div>
                            );
                        })}
                        <div className="text-center text-xs opacity-50 py-4">Êõ¥Â§ö‰ªªÂä°Â∞ÜÂú®Á¨¨‰∫åÂ§©Âà∑Êñ∞...</div>
                    </div>
                </div>
            );
        };

        const SettingsApp = ({ user, currentTheme, currentAvatar, changeTheme, changeAvatar, onReset, onLogout }) => (
            <div className="flex flex-col flex-1 min-h-0 screen-enter h-full">
                <div className="flex items-center gap-2 mb-6 shrink-0"><div className="w-10 h-10 bg-gray-500 rounded-full flex items-center justify-center text-white"><Icon path={Icons.Settings} /></div><h2 className="text-xl font-black opacity-80">ËÆæÁΩÆ</h2></div>
                <div className="flex-1 overflow-y-auto no-scrollbar space-y-6 pb-4">
                    <div className="nook-card border-l-8 border-[#3DAA86]">
                        <h3 className="font-bold text-[#59584D] mb-2">Â±ÖÊ∞ë‰ø°ÊÅØ</h3>
                        <div className="flex items-center gap-3 mb-4">
                            <div className="w-16 h-16 bg-white rounded-full flex items-center justify-center text-gray-400 overflow-hidden border-2 border-gray-100 shadow-inner"><img src={currentAvatar} alt="avatar" className="w-full h-full object-cover"/></div>
                            <div>
                                <div className="text-lg font-black text-[#59584D]">{user?.username || 'N/A'}</div>
                                <div className="text-xs text-gray-500 font-bold flex items-center gap-1">
                                    <Icon path={Icons.Mail} size={12} className="inline-block" /> {user?.email || 'N/A'}
                                </div>
                                <div className="text-[10px] text-gray-400 font-bold mt-1">ID: {user?.id}</div>
                            </div>
                        </div>
                        <button onClick={onLogout} className="nook-btn-secondary py-3 px-4 rounded-full font-bold text-sm text-gray-600 flex justify-center items-center gap-2 w-full"><Icon path={Icons.LogOut} size={16}/> ÈÄÄÂá∫ÁôªÂΩï</button>
                    </div>
                    <div className="nook-card">
                        <h3 className="font-bold text-[#59584D] mb-3">Êõ¥Êç¢ËØÅ‰ª∂ÁÖß</h3>
                        <div className="grid grid-cols-4 gap-2">{AVATAR_LIBRARY.map((url, idx) => (<button key={idx} onClick={()=>changeAvatar(url)} className={`w-full aspect-square rounded-full border-4 overflow-hidden bg-white flex items-center justify-center transition-transform hover:scale-105 ${currentAvatar === url ? 'border-[#3DAA86]' : 'border-transparent'}`}><img src={url} className="w-full h-full object-cover"/></button>))}</div>
                    </div>
                    <div className="nook-card">
                        <h3 className="font-bold text-[#59584D] mb-3">Êõ¥Êç¢ÊâãÊú∫Â£≥</h3>
                        <div className="grid grid-cols-2 gap-3">{THEMES.map(t => (<button key={t.id} onClick={()=>changeTheme(t.id)} className={`p-3 rounded-xl border-4 transition-all flex items-center gap-2 text-left bg-gray-100 ${currentTheme === t.id ? 'border-[#3DAA86] bg-white shadow-md' : 'border-transparent'}`}><div className="w-6 h-6 rounded-full border border-white shadow-sm" style={{background: t.bg}}></div><span className="text-xs font-bold text-gray-600">{t.name}</span></button>))}</div>
                    </div>
                    <div className="pb-4">
                        <button onClick={onReset} className="w-full py-4 rounded-3xl border-2 border-red-100 bg-red-50 text-red-500 font-black text-sm flex items-center justify-center gap-2 hover:bg-red-100 transition active:scale-95">
                            <Icon path={Icons.Danger} size={18}/> ÈáçÁΩÆÊï∞ÊçÆ
                        </button>
                    </div>
                </div>
            </div>
        );

        const PassportApp = ({ user, stats, avatar }) => {
            const levelInfo = getLevelInfo(stats?.xp || 0); 
            return (
                <div className="flex flex-col flex-1 min-h-0 screen-enter h-full">
                    <div className="bg-[#3D405B] rounded-[24px] overflow-hidden shadow-lg mb-6 text-[#F4F1DE] relative border-4 border-white/20 p-5 shrink-0 transition-transform hover:scale-[1.02]">
                        <div className="flex gap-4 items-center border-b border-white/10 pb-4 mb-4">
                            <div className="w-20 h-20 bg-[#F4F1DE] rounded-2xl flex items-center justify-center overflow-hidden border-4 border-white/10 shadow-inner"><img src={avatar} className="w-full h-full object-cover"/></div>
                            <div><div className="text-xl font-black">{user.username}</div><div className="text-sm opacity-80">Lv.{levelInfo.level} Â±ÖÊ∞ë</div></div>
                        </div>
                        <div className="grid grid-cols-2 gap-4"><div><div className="text-[10px] opacity-50 font-bold">TITLE</div><div className="text-sm font-bold">Êú™Êù•ÂèØÊúüÁöÑ / Â≤õÊ∞ë</div></div><div><div className="text-[10px] opacity-50 font-bold">JOINED</div><div className="text-sm font-bold">{new Date().getFullYear()}</div></div></div>
                    </div>
                    <div className="nook-card flex-1 flex items-center justify-center text-center p-6"><div className="opacity-50"><div className="text-4xl mb-2 animate-bounce">‚úàÔ∏è</div><p className="font-bold">Êõ¥Â§öÊä§ÁÖßÂäüËÉΩÂºÄÂèë‰∏≠...</p></div></div>
                </div>
            );
        };

        const AppIcon = ({ icon, label, onClick }) => (
            <div className="flex flex-col items-center gap-2 cursor-pointer app-icon-container" onClick={onClick}>
                <div className="app-icon"><Icon path={icon} size={30} color="#59584D"/></div>
                <span className="text-xs font-bold bg-white/40 px-2 py-0.5 rounded-full text-[#59584D] shadow-sm backdrop-blur-sm select-none">{label}</span>
            </div>
        );

        const DailyBroadcastApp = ({ tasks, ledger, fitLogs, voiceWorks }) => {
            const completedTasks = tasks.filter(t => t.completed).length;
            const pendingVoiceWork = voiceWorks.filter(w => !w.settled);
            const todayIntake = fitLogs.filter(l => l.type === 'intake' && l.date === new Date().toLocaleDateString()).reduce((sum, l) => sum + l.val, 0);
            
            return (
                <div className="flex flex-col flex-1 min-h-0 screen-enter h-full">
                    <div className="flex items-center gap-2 mb-6 shrink-0"><div className="w-10 h-10 bg-yellow-500 rounded-full flex items-center justify-center text-white"><Icon path={Icons.Radio} /></div><h2 className="text-xl font-black opacity-80">ÊØèÊó•Êí≠Êä•</h2></div>
                    <div className="flex-1 overflow-y-auto no-scrollbar space-y-4 pb-4">
                        <div className="nook-card border-l-8 border-blue-400">
                            <h3 className="font-bold text-[#59584D] mb-2 text-lg">Áã∏ÂÖãÂÖ¨Âëä</h3>
                            <p className="text-sm text-gray-500">‰ªäÊó•Â∑≤ÂÆåÊàê **{completedTasks}** ‰∏™ÈõÜÈáåÊ∏∏+‰ªªÂä°ÔºÅ</p>
                            <p className="text-sm text-gray-500 mt-2">ÊÇ®ÁöÑËÆ∞Ë¥¶Êú¨ÊòæÁ§∫Êú¨ÊúàÂ∑≤ÊîØÂá∫ **{(ledger.filter(l => l.type === 'expense').reduce((sum, l) => sum + l.amount, 0)).toLocaleString()}** ÈìÉÈí±„ÄÇ</p>
                        </div>
                         <div className="nook-card border-l-8 border-purple-400">
                            <h3 className="font-bold text-[#59584D] mb-2 text-lg">ÂΩïÈü≥ËøõÂ∫¶</h3>
                            {pendingVoiceWork.length > 0 ? (
                                <p className="text-sm text-gray-500">ÊÇ®Êúâ **{pendingVoiceWork.length}** ‰ªΩÂ∑•‰ΩúÂ∞öÊú™ÁªìÁÆóÔºåÊÄªËÆ° **{pendingVoiceWork.reduce((sum, w) => sum + w.price, 0).toLocaleString()}** Êä•ÈÖ¨Á≠âÂæÖÁ°ÆËÆ§„ÄÇ</p>
                            ) : (
                                <p className="text-sm text-green-500 font-bold">üéâ ÊâÄÊúâÂΩïÈü≥Â∑•‰ΩúÂùáÂ∑≤ÁªìÁÆóÔºÅ</p>
                            )}
                        </div>
                        <div className="nook-card border-l-8 border-red-400">
                            <h3 className="font-bold text-[#59584D] mb-2 text-lg">ÂÅ•Â∫∑ÊèêÈÜí</h3>
                            <p className="text-sm text-gray-500">Ê†πÊçÆ NookFit ËÆ∞ÂΩïÔºåÊÇ®‰ªäÂ§©Â∑≤ÊëÑÂÖ• **{todayIntake.toLocaleString()}** Â§ßÂç°„ÄÇËØ∑‰øùÊåÅÂÅ•Â∫∑ÂùáË°°ÔºÅ</p>
                        </div>
                    </div>
                </div>
            );
        };

        // ==========================================
        // 5. Main App Logic (Local Storage Implementation)
        // ==========================================

        const App = () => {
            // User Data State (replaces LeanCloud session)
            const [localUser, setLocalUser] = useState(null); // Used for auth check

            // App Data States
            const [userDoc, setUserDoc] = useState(null);
            const [stats, setStats] = useState(null);
            const [tasks, setTasks] = useState([]);
            const [ledger, setLedger] = useState([]);
            const [fitProfile, setFitProfile] = useState(null);
            const [fitLogs, setFitLogs] = useState([]);
            const [voiceWorks, setVoiceWorks] = useState([]); 
            
            // UI State
            const [isAuthReady, setIsAuthReady] = useState(false);
            const [isDataLoading, setIsDataLoading] = useState(true);
            const [currentApp, setCurrentApp] = useState(null);
            const [currentTime, setCurrentTime] = useState(new Date());
            const [resetStep, setResetStep] = useState(0);


            // --- 1. Timer ---
            useEffect(() => {
                const t = setInterval(() => setCurrentTime(new Date()), 1000);
                return () => clearInterval(t);
            }, []);
            
            // --- 2. Data Fetcher (Local Storage) ---
            const fetchData = useCallback((userData) => {
                if (!userData) {
                    // Logged out: clear all state
                    setUserDoc(null); setStats(null); setTasks([]); setLedger([]); setFitProfile(null); setFitLogs([]); setVoiceWorks([]);
                    setIsDataLoading(false);
                    return;
                }

                setIsDataLoading(true);
                
                const data = getLocalData();

                // If no local data exists, initialize it with initial mock data
                if (!data) {
                    setLocalData(INITIAL_DATA);
                    const initialData = getLocalData();
                    setUserDoc(initialData.userDoc);
                    setStats(initialData.stats);
                    setFitProfile(initialData.fitProfile);
                    setTasks(initialData.tasks.sort((a,b) => b.createdAt - a.createdAt));
                    setLedger(initialData.ledger.sort((a,b) => b.timestamp - a.timestamp));
                    setFitLogs(initialData.fitLogs.sort((a,b) => b.timestamp - a.timestamp));
                    setVoiceWorks(initialData.voiceWorks.sort((a,b) => b.createdAt - a.createdAt));

                } else {
                    // Load existing local data
                    setUserDoc(data.userDoc);
                    setStats(data.stats);
                    setFitProfile(data.fitProfile);
                    // Ensure sorting is applied locally
                    setTasks(data.tasks.sort((a,b) => b.createdAt - a.createdAt));
                    setLedger(data.ledger.sort((a,b) => b.timestamp - a.timestamp));
                    setFitLogs(data.fitLogs.sort((a,b) => b.timestamp - a.timestamp));
                    setVoiceWorks(data.voiceWorks.sort((a,b) => b.createdAt - a.createdAt));
                }
                
                setIsDataLoading(false);
            }, []);

            // --- 3. Initial Load ---
            useEffect(() => {
                // Check if local data exists to simulate a "logged in" state
                const data = getLocalData();
                if (data) {
                    setLocalUser(data.userDoc);
                    fetchData(data.userDoc);
                }
                setIsAuthReady(true);
            }, [fetchData]);

            // --- 4. Data Saver (Single point of truth update) ---
            const updateLocalData = useCallback((key, newData) => {
                // Use a single function to update state and local storage atomically
                let dataToSave = {};
                
                if (key === 'userDoc') {
                    setUserDoc(newData);
                    dataToSave = { ...getLocalData(), userDoc: newData };
                } else if (key === 'stats') {
                    setStats(newData);
                    dataToSave = { ...getLocalData(), stats: newData };
                } else if (key === 'fitProfile') {
                    setFitProfile(newData);
                    dataToSave = { ...getLocalData(), fitProfile: newData };
                } else if (key === 'tasks') {
                    setTasks(newData.sort((a,b) => b.createdAt - a.createdAt));
                    dataToSave = { ...getLocalData(), tasks: newData };
                } else if (key === 'ledger') {
                    setLedger(newData.sort((a,b) => b.timestamp - a.timestamp));
                    dataToSave = { ...getLocalData(), ledger: newData };
                } else if (key === 'fitLogs') {
                    setFitLogs(newData.sort((a,b) => b.timestamp - a.timestamp));
                    dataToSave = { ...getLocalData(), fitLogs: newData };
                } else if (key === 'voiceWorks') {
                    setVoiceWorks(newData.sort((a,b) => b.createdAt - a.createdAt));
                    dataToSave = { ...getLocalData(), voiceWorks: newData };
                }

                setLocalData(dataToSave);
            }, []);


            const handleAuthSuccess = useCallback((userData) => {
                // Simulate login success by setting local user and fetching data
                setLocalUser(userData);
                fetchData(userData);
            }, [fetchData]);

            // --- 5. UI Actions (Now updating local state/storage) ---
            const updateTheme = (id) => {
                const t = THEMES.find(x => x.id === id) || THEMES[0];
                const r = document.documentElement.style;
                r.setProperty('--theme-bg', t.bg);
                r.setProperty('--theme-primary', t.primary);
                r.setProperty('--theme-text', t.text);
                r.setProperty('--theme-btn-shadow', t.shadow);
            };

            useEffect(() => {
                if (userDoc?.themeId) updateTheme(userDoc.themeId);
            }, [userDoc?.themeId]);

            const handleLogout = () => {
                setLocalUser(null);
                setCurrentApp(null);
                fetchData(null); // Clear local state
            };
            
            // Function to reset all data (deletes local storage key)
            const handleReset = () => {
                if (!localUser) return;
                
                localStorage.removeItem(LOCAL_STORAGE_KEY);
                setResetStep(0);
                handleLogout(); 
            };
            
            // --- Actions passed to sub-apps ---
            const taskActions = {
                addTask: (title, diff, type, reward, money, calories) => {
                    const newDoc = Factories.Task(title, diff, type, reward, money, calories);
                    updateLocalData('tasks', [newDoc, ...tasks]);
                },
                completeTask: (taskId) => {
                    const t = tasks.find(x => x.id === taskId);
                    if(t && !t.completed) {
                        
                        // 1. Update Task completion
                        const updatedTask = { ...t, completed: true, createdAt: t.createdAt };
                        updateLocalData('tasks', tasks.map(task => task.id === taskId ? updatedTask : task));
                        
                        // 2. Update Stats (Miles and XP) 
                        if (stats) {
                            const newStatsData = { ...stats, miles: stats.miles + t.reward, xp: stats.xp + t.reward };
                            updateLocalData('stats', newStatsData);
                        }
                        
                        // 3. Add Ledger records if applicable
                        if(t.money) {
                            const newLedger = Factories.Ledger(t.money.type, t.money.amount, '‰ªªÂä°', t.title);
                            updateLocalData('ledger', [newLedger, ...ledger]);
                        }
                        
                        // 4. Add FitLog records if applicable
                        if(t.calories) {
                            const newFitLog = Factories.FitLog(new Date().toLocaleDateString(), t.type === 'ÂÅ•Ë∫´' ? 'exercise' : 'intake', t.calories, t.title);
                            updateLocalData('fitLogs', [newFitLog, ...fitLogs]);
                        }
                    }
                }
            };

            const ledgerActions = {
                addRecord: (type, amount, cat, note) => {
                    const newDoc = Factories.Ledger(type, amount, cat, note);
                    updateLocalData('ledger', [newDoc, ...ledger]);
                },
                deleteRecord: (id) => {
                    updateLocalData('ledger', ledger.filter(record => record.id !== id));
                }
            };

            const fitnessActions = {
                updateProfile: (p) => {
                    updateLocalData('fitProfile', p);
                },
                addLog: (type, val, note) => {
                    const newDoc = Factories.FitLog(new Date().toLocaleDateString(), type, val, note);
                    updateLocalData('fitLogs', [newDoc, ...fitLogs]);
                }
            };

            const voiceWorkActions = {
                addWork: (title, price) => {
                    const newDoc = Factories.VoiceWork(title, price);
                    updateLocalData('voiceWorks', [newDoc, ...voiceWorks]);
                },
                toggleSettled: (id) => {
                    const updatedWorks = voiceWorks.map(w => w.id === id ? { ...w, settled: !w.settled, createdAt: w.createdAt } : w);
                    updateLocalData('voiceWorks', updatedWorks);
                },
                deleteWork: (id) => {
                    updateLocalData('voiceWorks', voiceWorks.filter(w => w.id !== id));
                }
            };

            const financeActions = {
                updateStats: (newStats) => {
                    updateLocalData('stats', { ...stats, ...newStats });
                }
            };
            
            const settingsActions = {
                changeTheme: (id) => {
                    const updatedUserDoc = { ...userDoc, themeId: id };
                    updateLocalData('userDoc', updatedUserDoc);
                    updateTheme(id);
                },
                changeAvatar: (url) => {
                    const updatedUserDoc = { ...userDoc, avatar: url };
                    updateLocalData('userDoc', updatedUserDoc);
                }
            };

            if (!isAuthReady) return <div className="w-full h-full flex flex-col items-center justify-center bg-[#7FE2C3] animate-pop"><div className="w-24 h-24 bg-white rounded-[30px] flex items-center justify-center shadow-lg animate-bounce"><Icon path={Icons.Leaf} size={60} color="#3DAA86"/></div></div>;

            if (resetStep > 0) {
                 return (
                     <div className="absolute inset-0 z-50 flex flex-col items-center justify-center p-6 bg-black/60 backdrop-blur-sm animate-pop">
                        <div className="nook-card w-full max-w-xs text-center border-4 border-red-500 shadow-2xl">
                            <h2 className="text-xl font-black text-[#59584D] mb-2">{resetStep === 1 ? "Á°ÆÂÆöË¶ÅÈáçÁΩÆÂêóÔºü" : "ÊúÄÂêéË≠¶ÂëäÔºÅ"}</h2>
                            <p className="text-sm text-gray-500 font-bold mb-6">ÊÇ®Â∞ÜÊ∏ÖÈô§Êú¨Âú∞Â≠òÂÇ®‰∏≠ÁöÑÊâÄÊúâÊï∞ÊçÆÔºåÊó†Ê≥ïÊÅ¢Â§ç„ÄÇ</p>
                            <div className="space-y-3">
                                <button onClick={() => resetStep === 1 ? setResetStep(2) : handleReset()} className="nook-btn w-full bg-red-500">{resetStep === 1 ? "Á°ÆÂÆöÊ∏ÖÈô§" : "ÂΩªÂ∫ïÈîÄÊØÅ"}</button>
                                <button onClick={() => setResetStep(0)} className="nook-btn-secondary w-full">ÂèñÊ∂à</button>
                            </div>
                        </div>
                     </div>
                );
            }

            // Check if user is logged in
            if (!localUser) return <AuthScreen onAuthSuccess={handleAuthSuccess} />;

            // Show loading if auth is ready but data hasn't been fetched yet
            if (isDataLoading || !userDoc || !stats || !fitProfile) return <div className="w-full h-full flex flex-col items-center justify-center bg-[#7FE2C3] animate-pop"><div className="w-24 h-24 bg-white rounded-[30px] flex items-center justify-center shadow-lg animate-bounce"><Icon path={Icons.Leaf} size={60} color="#3DAA86"/></div><p className="mt-4 font-bold text-[#59584D]">Ê≠£Âú®Âä†ËΩΩÊú¨Âú∞Êï∞ÊçÆ...</p></div>;


            return (
                <div className="w-full h-full flex flex-col items-center justify-center md:p-4 transition-all">
                    {/* Main Container */}
                    <div className="w-full h-full md:h-[85vh] md:max-w-[520px] md:min-h-[700px] bg-white/20 backdrop-blur-xl md:rounded-[45px] shadow-2xl md:border-[8px] border-white/40 relative overflow-hidden flex flex-col transition-all duration-500">
                        
                        {/* Status Bar */}
                        <div className="h-12 flex justify-between items-center px-8 shrink-0 z-20 pt-2 text-[#59584D] select-none pointer-events-none">
                            <div className="bg-white/40 px-3 py-1 rounded-full text-xs font-bold backdrop-blur-sm shadow-sm">{currentTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
                            <div className="bg-white/40 px-3 py-1 rounded-full text-xs font-bold backdrop-blur-sm flex items-center gap-1 shadow-sm"><div className="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div> ‚òÅÔ∏è Local</div>
                        </div>

                        {/* App Content Area */}
                        <div className="flex-1 overflow-hidden relative p-4 md:p-6">
                            {/* Desktop Icons Grid */}
                            <div className={`absolute inset-0 p-8 grid grid-cols-3 content-start gap-y-8 gap-x-4 transition-all duration-500 ease-[cubic-bezier(0.34,1.56,0.64,1)] ${currentApp ? '-translate-x-12 opacity-0 scale-90 pointer-events-none' : 'translate-x-0 opacity-100 scale-100'}`}>
                                <AppIcon icon={Icons.Leaf} label="ÈõÜÈáåÊ∏∏+" onClick={()=>setCurrentApp('miles')}/>
                                <AppIcon icon={Icons.Book} label="ËÆ∞Ë¥¶Êú¨" onClick={()=>setCurrentApp('ledger')}/>
                                <AppIcon icon={Icons.Activity} label="NookFit" onClick={()=>setCurrentApp('fitness')}/>
                                <AppIcon icon={Icons.CreditCard} label="ABD" onClick={()=>setCurrentApp('finance')}/>
                                <AppIcon icon={Icons.Mic} label="ÂΩïÈü≥Âä©Êâã" onClick={()=>setCurrentApp('voice')}/> 
                                <AppIcon icon={Icons.User} label="Êä§ÁÖß" onClick={()=>setCurrentApp('passport')}/>
                                <AppIcon icon={Icons.Radio} label="ÊØèÊó•Êí≠Êä•" onClick={()=>setCurrentApp('daily')}/> 
                                <AppIcon icon={Icons.Settings} label="ËÆæÁΩÆ" onClick={()=>setCurrentApp('settings')}/>
                            </div>

                            {/* Active App Container */}
                            <div className={`absolute inset-0 p-0 md:p-6 transition-all duration-500 ease-[cubic-bezier(0.34,1.56,0.64,1)] flex flex-col ${currentApp ? 'translate-y-0 opacity-100 scale-100' : 'translate-y-20 opacity-0 scale-90 pointer-events-none'}`}>
                                <div className="glass-panel w-full h-full rounded-none md:rounded-[35px] shadow-inner flex flex-col p-4 md:p-6 relative overflow-hidden">
                                    {currentApp === 'daily' && <DailyBroadcastApp tasks={tasks} ledger={ledger} fitLogs={fitLogs} voiceWorks={voiceWorks} />} 
                                    {currentApp === 'miles' && <NookMilesApp stats={stats} tasks={tasks} {...taskActions}/>}
                                    {currentApp === 'ledger' && <LedgerApp ledger={ledger} {...ledgerActions}/>}
                                    {currentApp === 'fitness' && <FitnessApp profile={fitProfile} logs={fitLogs} user={userDoc.username} {...fitnessActions}/>}
                                    {currentApp === 'voice' && <VoiceWorkApp voiceWorks={voiceWorks} {...voiceWorkActions}/>} 
                                    {currentApp === 'finance' && <FinanceApp stats={stats} {...financeActions}/>}
                                    {currentApp === 'passport' && <PassportApp user={userDoc} stats={stats} avatar={userDoc.avatar}/>}
                                    {currentApp === 'settings' && <SettingsApp user={userDoc} currentTheme={userDoc.themeId} currentAvatar={userDoc.avatar} {...settingsActions} onReset={()=>setResetStep(1)} onLogout={handleLogout}/>}
                                    
                                    {/* Bottom Home Indicator */}
                                    <div className="mt-auto pt-2 flex justify-center shrink-0 absolute bottom-4 left-0 right-0 z-40 pointer-events-none">
                                        <button onClick={()=>setCurrentApp(null)} className="nook-btn-secondary px-6 py-2 rounded-full font-bold text-sm shadow-lg pointer-events-auto opacity-90 hover:opacity-100 hover:scale-105 transition-all active:scale-95 backdrop-blur-md bg-white/80">
                                            ËøîÂõûÊ°åÈù¢
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Phone Chin */}
                        <div className="hidden md:flex h-8 w-full justify-center items-center shrink-0 z-20 pb-2">
                            <div className="w-1/3 h-1.5 bg-white/60 rounded-full"></div>
                        </div>
                    </div>
                    <div className="hidden md:block mt-4 text-white/80 font-bold text-xs tracking-widest opacity-80 uppercase">Nook Inc. OS v6.3 (Local Edition)</div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>